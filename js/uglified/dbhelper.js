"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"createIDBObjectStores",value:function(){dbPromise=idb.open("fetchedData",1,function(e){switch(e.oldVersion){case 0:e.createObjectStore("restaurantsStore",{keyPath:"id"});for(var t=1;t<=10;t++)e.createObjectStore("reviewsStore"+t,{keyPath:"id"})}})}},{key:"fetchRestaurants",value:function(r){var a=["Some people having fun while eating","a big tasty pizza","Stylish food court with polished wooden chairs","Nice exterior scene for the restaurant during night","People eating while the restaurant staff appears preparing pizza behind","Simple decorative with wooden chairs and roof and big flag of America","Exterior scene for restaurant in black and white","A magnificent exterior scene for the restaurant during the day","Close up picture in black and white, Many Asians eating using sticks","A modern decorative theme in white and light grey appears bar and many tables"];dbPromise.then(function(e){return e.transaction("restaurantsStore").objectStore("restaurantsStore").getAll()}).then(function(e){0!=e?r(null,e):fetch("http://127.0.0.1:1337/restaurants").then(function(e){if(200===e.status)return e.json();var t="Request failed. Returned status of "+e.status;r(t,null)}).then(function(n){n.map(function(e,t){e.photograph={photoJPG400:e.id+"_400.jpg",photoJPG:e.id+".jpg",photoWebp400:e.id+"_400.webp",photoWebp:e.id+".webp",alt:a[t]}}),dbPromise.then(function(e){var t=e.transaction("restaurantsStore","readwrite");n.map(function(e){return t.objectStore("restaurantsStore").put(e),t.complete}),r(null,n)}).catch(function(e){console.log(e)})})})}},{key:"fetchReviewsById",value:function(r,a){dbPromise.then(function(e){return e.transaction("reviewsStore"+r).objectStore("reviewsStore"+r).getAll()}).then(function(e){0!=e?a(null,e):fetch("http://localhost:1337/reviews/?restaurant_id="+r).then(function(e){if(200===e.status)return e.json();var t="Request failed. Returned status of "+e.status;a(t,null)}).then(function(n){dbPromise.then(function(e){var t=e.transaction("reviewsStore"+r,"readwrite");n.map(function(e){return t.objectStore("reviewsStore"+r).put(e),t.complete}),a(null,n)}).catch(function(e){console.log(e)})})})}},{key:"addReviewToIndexedDB",value:function(t){dbPromise.then(function(e){e.transaction("reviewsStore"+t.restaurant_id,"readwrite").objectStore("reviewsStore"+t.restaurant_id).put(t)})}},{key:"isRestaurantFavorite",value:function(e,t){"true"==t.is_favorite?(e.style.color="lightgreen",e.setAttribute("aria-label","favorite checked")):(e.style.color="lightgrey",e.setAttribute("aria-label","favorite unchecked"))}},{key:"handleBtnClick",value:function(e,n){var r=null;dbPromise.then(function(e){return e.transaction("restaurantsStore").objectStore("restaurantsStore").get(n)}).then(function(t){"true"==t.is_favorite?(r="false",e.style.color="lightgray"):(r="true",e.style.color="lightgreen"),fetch("http://localhost:1337/restaurants/"+n+"/?is_favorite="+r,{method:"PUT"}).then(function(){t.is_favorite=r,dbPromise.then(function(e){e.transaction("restaurantsStore","readwrite").objectStore("restaurantsStore").put(t)})})})}},{key:"fetchRestaurantById",value:function(r,a){n.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t[r-1];0!=n?a(null,n):a("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,a){n.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});a(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,a){n.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});a(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,a,o){n.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=a&&(n=n.filter(function(e){return e.neighborhood==a})),o(null,n)}})}},{key:"fetchNeighborhoods",value:function(a){n.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"fetchCuisines",value:function(a){n.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"pictureSrcsetForRestaurant",value:function(e){return"/img/"+e.photograph.photoWebp400+" 400w, /img/"+e.photograph.photoWebp+" 800w"}},{key:"imageSrcsetForRestaurant",value:function(e){return"/img/"+e.photograph.photoJPG400+" 400w, /img/"+e.photograph.photoJPG+" 800w"}},{key:"imageSrcForRestaurant",value:function(e){return"/img/"+e.photograph.photoJPG}},{key:"imageAltForRestaurant",value:function(e){return""+e.photograph.alt}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:n.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}]),n}();window.addEventListener("load",function(){document.querySelector("iframe").setAttribute("tabIndex","-1")});var dbPromise=void 0;DBHelper.createIDBObjectStores();